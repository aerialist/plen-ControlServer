"use strict";var APP_NAME="PLEN Utils",SERVER_STATE,PLENControlServerService,ConnectButtonController,ConnectButtonDirective,motion_schema,MotionStore,InstallButtonController,InstallButtonDirective,JointSettingsModel,JointRadioListController,JointRadioListDirective,JointSelectorController,JointSelectorDirective,LoadButtonController,LoadButtonDirective,ProgressBarController,ProgressBarDirective,SetterButtonsController,SetterButtonsDirective,ValueChangerController,ValueChangerDirective;angular.module(APP_NAME,[]),function(n){n[n.DISCONNECTED=0]="DISCONNECTED";n[n.CONNECTED=1]="CONNECTED";n[n.WAITING=2]="WAITING"}(SERVER_STATE||(SERVER_STATE={}));PLENControlServerService=function(){function n(n,t){this.$http=n;this.$rootScope=t;this._state=0;this._socket=null;this._ip_addr="localhost:17264";this.connect()}return n.prototype.connect=function(n){var t=this;n===void 0&&(n=null);this._state===0&&(this._state=2,this.$http.get("//"+this._ip_addr+"/v2/connect").success(function(i){i.data.result===!0?(t._state=1,t._createWebSocket(),_.isNull(n)||n()):(t._state=0,alert("USB connection has been disconnected!"))}).error(function(){t._state=0;alert("The control-server hasn't run.")}))},n.prototype.install=function(n,t){var i=this;t===void 0&&(t=null);this._state===1&&(this._state=2,this.$http.put("//"+this._ip_addr+"/v2/motions/"+n.slot.toString(),n).success(function(n){i._state=1;n.data.result===!0&&(_.isNull(t)||t())}).error(function(){i._state=0}).finally(function(){i.$rootScope.$broadcast("InstallFinished")}))},n.prototype.applyNative=function(n,t){this._state===1&&(this._socket.send("apply/"+n+"/"+t.toString()),this._state=2)},n.prototype.setMin=function(n,t){this._state===1&&(this._socket.send("setMin/"+n+"/"+t.toString()),this._state=2)},n.prototype.setMax=function(n,t){this._state===1&&(this._socket.send("setMax/"+n+"/"+t.toString()),this._state=2)},n.prototype.setHome=function(n,t){this._state===1&&(console.log("setHome"),this._socket.send("setHome/"+n+"/"+t.toString()),this._state=2)},n.prototype.getStatus=function(){return this._state},n.prototype._createWebSocket=function(){var n=this;_.isNull(this._socket)||(this._socket.close(),this._socket=null);this._socket=new WebSocket("ws://"+this._ip_addr+"/v2/cmdstream");this._socket.onopen=function(){n._socket.readyState===WebSocket.OPEN&&(n._state=1,n.$rootScope.$apply())};this._socket.onmessage=function(t){t.data=="False"?n._state===2&&(n._state=0,n.$rootScope.$apply(),alert("USB connection has been disconnected!")):n._state=1};this._socket.onerror=function(){n._state=0;n.$rootScope.$apply();alert("The control-server hasn't run.")}},n.$inject=["$http","$rootScope"],n}();angular.module(APP_NAME).service("PLENControlServerService",PLENControlServerService);ConnectButtonController=function(){function n(n){this.server=n}return n.prototype.getServerStatus=function(){return this.server.getStatus()===1?"Connected!":this.server.getStatus()===0?"Disconnected!":"Connected!"},n.prototype.onClick=function(){this.server.connect()},n.$inject=["PLENControlServerService"],n}();ConnectButtonDirective=function(){function n(){}return n.getDDO=function(){return{restrict:"E",controller:ConnectButtonController,controllerAs:"$ctrl",scope:{},templateUrl:"./angularjs/components/ConnectButton/view.html",replace:!0}},n}();angular.module(APP_NAME).directive("connectButton",[ConnectButtonDirective.getDDO]);motion_schema={description:"Structure of a motion",type:"object",properties:{slot:{description:"Index that the motion is placed",type:"integer",minimum:0,maximum:89},name:{description:"Name of the motion",type:"string",minLength:0,maxLength:20},"@frame_length":{description:"Length of the frames",type:"integer",minimum:1,maximum:20,optional:!0},codes:{description:"Array of code",type:"array",items:{description:"Structure of a code",type:"object",properties:{mathod:{description:"Method name you would like to call",type:"string"},arguments:{description:"arguments of the method",type:"array",items:{type:"any"}}}}},frames:{description:"Array of frame",type:"array",minItems:1,maxItems:20,items:{description:"Structure of a frame",type:"object",properties:{"@index":{description:"Index of the frame",type:"integer",minimum:0,maximum:19,optional:!0},transition_time_ms:{description:"Time of transition to the frame",type:"integer",minimum:32,maximum:65535},stop_flag:{description:"To select using stop flag or not (Working Draft)",type:"boolean",optional:!0},auto_balance:{description:"To select using auto balancer or not (Working Draft)",type:"boolean",optional:!0},outputs:{description:"Array of output",type:"array",items:{description:"Structure of a output",type:"object",properties:{device:{description:"Name of the output device",type:"string"},value:{description:"Value of the output",type:"integer"}}}}}}}}};MotionStore=function(){function n(){this._typeChecker={object:_.isObject.bind(_),array:_.isArray.bind(_),integer:_.isNumber.bind(_),string:_.isString.bind(_),boolean:_.isBoolean.bind(_),any:function(){return!0}};this._containsChecker={object:function(n,t){var r=_.keys(n.properties),i=!0;return _.forEach(r,function(r){i!==!1&&(_.has(t,r)||(i=Boolean(n.properties[r].optional)))}),i},array:function(n,t){var i=!0,r=!0;return _.has(n,"minItems")&&(i=n.minItems<=t.length),_.has(n,"maxItems")&&(r=t.length<=n.maxItems),i&&r},integer:function(n,t){var i=!0,r=!0;return _.has(n,"minimum")&&(i=n.minimum<=t),_.has(n,"maximum")&&(r=t<=n.maximum),i&&r},string:function(n,t){var i=!0,r=!0;return _.has(n,"minLength")&&(i=n.minLength<=t.length),_.has(n,"maxLength")&&(r=t.length<=n.maxLength),i&&r},boolean:function(){return!0},any:function(){return!0}};this._typeTraversable={object:function(n,t){var i=n.properties,u=_.keys(i),r=[];return _.forEach(u,function(n){r.push({schema:i[n],json:t[n]})}),r},array:function(n,t){var r=n.items,i=[];return _.forEach(t,function(n){i.push({schema:r,json:n})}),i},integer:function(){return[]},string:function(){return[]},boolean:function(){return[]},any:function(){return[]}};this.motions=[]}return n.prototype._validateType=function(n,t){return this._typeChecker[n.type](t)},n.prototype._validateContains=function(n,t){return this._validateType(n,t)?this._containsChecker[n.type](n,t):_.isUndefined(t)?Boolean(n.optional):!1},n.prototype._traverse=function(n,t){var r=this,i;if(!this._validateContains(n,t)){console.log("Bad format!:\n - schema = %O\n - json = %O",n,t);throw"Bad format!";}i=this._typeTraversable[n.type](n,t);_.forEach(i,function(n){r._traverse(n.schema,n.json)})},n.prototype.validate=function(n){try{this._traverse(motion_schema,n)}catch(t){return!1}return!0},n}();angular.module(APP_NAME).service("SharedMotionStoreService",MotionStore);InstallButtonController=function(){function n(n,t,i,r){var u=this;this.$rootScope=t;this.ctrl_server_service=i;this.motion_store=r;this._progress_count=0;this._motions_count=0;n.$on("InstallFinished",function(){u._onInstallFinished()})}return n.prototype._onInstallFinished=function(){this._progress_count++;this.$rootScope.$broadcast("InstalledProgressAdvances",this._progress_count/this._motions_count);this._progress_count===this._motions_count&&(alert("Installation of all motion files was finished!"),this.$rootScope.$broadcast("InstalledProgressAdvances",0))},n.prototype.onClick=function(){var n=this,t;this._progress_count=0;this._motions_count=this.motion_store.motions.length;t=function(){n.motion_store.motions.length!==0&&n.ctrl_server_service.getStatus()===1&&n.ctrl_server_service.install(n.motion_store.motions.pop(),t)};t()},n.prototype.getStoredMotionsCount=function(){return this.motion_store.motions.length?" ("+this.motion_store.motions.length.toString()+")":""},n.$inject=["$scope","$rootScope","PLENControlServerService","SharedMotionStoreService"],n}();InstallButtonDirective=function(){function n(){}return n.getDDO=function(){return{restrict:"E",controller:InstallButtonController,controllerAs:"$ctrl",scope:{},templateUrl:"./angularjs/components/InstallButton/view.html",replace:!0}},n}();angular.module(APP_NAME).directive("installButton",[InstallButtonDirective.getDDO]);JointSettingsModel=function(){function n(){this.joint_handle="left_shoulder_pitch";this.joint_settings={left_shoulder_pitch:{name:"Left Shoulder Pitch",value:0},left_thigh_yaw:{name:"Left Thigh Yaw",value:0},left_shoulder_roll:{name:"Left Shoulder Roll",value:0},left_elbow_roll:{name:"Left Elbow Roll",value:0},left_thigh_roll:{name:"Left Thigh Roll",value:0},left_thigh_pitch:{name:"Left Thigh Pitch",value:0},left_knee_pitch:{name:"Left Knee Pitch",value:0},left_foot_pitch:{name:"Left Foot Pitch",value:0},left_foot_roll:{name:"Left Foot Roll",value:0},right_shoulder_pitch:{name:"Right Shoulder Pitch",value:0},right_thigh_yaw:{name:"Right Thigh Yaw",value:0},right_shoulder_roll:{name:"Right Shoulder Roll",value:0},right_elbow_roll:{name:"Right Elbow Roll",value:0},right_thigh_roll:{name:"Right Thigh Roll",value:0},right_thigh_pitch:{name:"Right Thigh Pitch",value:0},right_knee_pitch:{name:"Right Knee Pitch",value:0},right_foot_pitch:{name:"Right Foot Pitch",value:0},right_foot_roll:{name:"Right Foot Roll",value:0}}}return n.prototype.setValue=function(n){this.joint_settings[this.joint_handle].value=n},n.prototype.getValue=function(){return this.joint_settings[this.joint_handle].value},Object.defineProperty(n.prototype,"current",{get:function(){return this.getValue()},set:function(n){_.isString(n)&&this.setValue(_.parseInt(n));_.isNumber(n)&&this.setValue(n)},enumerable:!0,configurable:!0}),n}();angular.module(APP_NAME).service("SharedJointSettingsService",JointSettingsModel);JointRadioListController=function(){function n(n){this.joint_settings_model=n}return n.$inject=["SharedJointSettingsService"],n}();JointRadioListDirective=function(){function n(){}return n.getDDO=function(){return{restrict:"E",controller:JointRadioListController,controllerAs:"$ctrl",scope:{},templateUrl:"./angularjs/components/JointRadioList/view.html",replace:!0}},n}();angular.module(APP_NAME).directive("jointRadioList",[JointRadioListDirective.getDDO]);JointSelectorController=function(){function n(n){this.joint_settings_model=n}return n.prototype.onClick=function(n){this.joint_settings_model.joint_handle=n},n.$inject=["SharedJointSettingsService"],n}();JointSelectorDirective=function(){function n(){}return n.getDDO=function(){return{restrict:"E",controller:JointSelectorController,controllerAs:"$ctrl",scope:{},templateUrl:"./angularjs/components/JointSelector/view.html",replace:!0,link:function(n,t,i,r){var u=t.find(".joint_button");
/*!
                    @attention
                    You shouldn't use the arrow-function sugar syntax therefore 'this' binding by jQuery will be broken.
                */
u.on("click",function(){u.removeClass("is-selected");$(this).addClass("is-selected");r.onClick($(this).attr("id"));n.$apply()})}}},n}();angular.module(APP_NAME).directive("jointSelector",[JointSelectorDirective.getDDO]);LoadButtonController=function(){function n(n,t){this.$scope=n;this.motion_store=t}return n.prototype.onChange=function(n){var t=this,i=n.target.files,r=0,u=function(n){r++;var u=JSON.parse(n.target.result);t.motion_store.validate(u)&&t.motion_store.motions.push(u);r===i.length&&t.$scope.$apply()};_.each(i,function(n){
/*!
                @attention
                You need to create some FileReader instances to avoid busy wait error.
            */
var t=new FileReader;t.onload=u;t.readAsText(n)})},n.$inject=["$scope","SharedMotionStoreService",],n}();LoadButtonDirective=function(){function n(){}return n.getDDO=function(){return{restrict:"E",controller:LoadButtonController,controllerAs:"$ctrl",scope:{},templateUrl:"./angularjs/components/LoadButton/view.html",replace:!0,link:function(n,t,i,r){
/*!
                    @attention
                    You need to set the change event handler yourself,
                    because ng-change directive is not resolved automatically if without ng-model directive.
                */
t.find("input").on("change",r.onChange.bind(r))}}},n}();angular.module(APP_NAME).directive("loadButton",[LoadButtonDirective.getDDO]);ProgressBarController=function(){function n(n){var t=this;this._installed_progress=0;n.$on("InstalledProgressAdvances",function(n,i){t._onInstalledProgressAdvances(n,i)})}return n.prototype._onInstalledProgressAdvances=function(n,t){this._installed_progress=Math.round(t*100)},n.prototype.getInstalledProgressPercent=function(){return this._installed_progress.toString()+"%"},n.$inject=["$scope"],n}();ProgressBarDirective=function(){function n(){}return n.getDDO=function(){return{restrict:"E",controller:ProgressBarController,controllerAs:"$ctrl",scope:{},templateUrl:"./angularjs/components/ProgressBar/view.html",replace:!0}},n}();angular.module(APP_NAME).directive("progressBar",[ProgressBarDirective.getDDO]);SetterButtonsController=function(){function n(n,t){this.ctrl_server_service=n;this.joint_settings=t}return n.prototype.onClickMax=function(){this.ctrl_server_service.setMax(this.joint_settings.joint_handle,this.joint_settings.getValue())},n.prototype.onClickHome=function(){this.ctrl_server_service.setHome(this.joint_settings.joint_handle,this.joint_settings.getValue())},n.prototype.onClickMin=function(){this.ctrl_server_service.setMin(this.joint_settings.joint_handle,this.joint_settings.getValue())},n.prototype.onClickReset=function(){this.joint_settings.setValue(0);this.ctrl_server_service.applyNative(this.joint_settings.joint_handle,0)},n.$inject=["PLENControlServerService","SharedJointSettingsService"],n}();SetterButtonsDirective=function(){function n(){}return n.getDDO=function(){return{restrict:"E",controller:SetterButtonsController,controllerAs:"$ctrl",scope:{},templateUrl:"./angularjs/components/SetterButtons/view.html",replace:!0}},n}();angular.module(APP_NAME).directive("setterButtons",[SetterButtonsDirective.getDDO]);ValueChangerController=function(){function n(n,t){this.ctrl_server_service=n;this.joint_settings_model=t}return n.prototype.onChange=function(){this.ctrl_server_service.applyNative(this.joint_settings_model.joint_handle,this.joint_settings_model.getValue())},n.prototype.getJointName=function(){return this.joint_settings_model.joint_settings[this.joint_settings_model.joint_handle].name},n.$inject=["PLENControlServerService","SharedJointSettingsService"],n}();ValueChangerDirective=function(){function n(){}return n.getDDO=function(){return{restrict:"E",controller:ValueChangerController,controllerAs:"$ctrl",scope:{},templateUrl:"./angularjs/components/ValueChanger/view.html",replace:!0}},n}();angular.module(APP_NAME).directive("valueChanger",[ValueChangerDirective.getDDO]);
//# sourceMappingURL=bundle.min.js.map
